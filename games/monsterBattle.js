/*
@title: monster battle
@author: shadee
*/


const player = "p";
const monster = "g";
const spikes = "s";
const armor = "a";
const powerup = "u"

setLegend(
  [ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],
  [ monster, bitmap`
................
.............555
.............5..
....444444...555
...44....44....5
...4.0...04..555
...4.00..0.4....
...4.00..004....
...400....000...
...44......40...
....4......4....
....44....44....
.....444444.....
................
................
................`],
  [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`],
  [ powerup, bitmap`
..........44444.
..........44..4.
..........44444.
...........111..
...........1.1..
...........1.1..
.1.........1.1..
111.11111..1.1..
..1.1...1..1.1..
..1.1...1..1.1..
..111...1111.1..
.............1..
............11..
11111111111.1...
...........11...
................`]
);

let level = 0;
let playerHealth = 10;
let monsterHealth = 5;
let attackPower = 1;
const levels = [
  map`
usp..g`
];
let gotPowerUp = 0;


const currentLevel = levels[level];
setMap(currentLevel);

setSolids([player,monster]);

setPushables({
  [player]: []
});

// START - PLAYER MOVEMENT CONTROLS

onInput("d", () => {
  getFirst(player).x += 1;
  if (getFirst(player).x === getFirst(spikes).x){
    playerHealth = playerHealth - 3;
  }
});
onInput("a", () => {
  getFirst(player).x -= 1;
  if (getFirst(player).x === getFirst(spikes).x){
    playerHealth = playerHealth - 4;
  }
});
onInput("l", () => {
  if (getFirst(player).x + 1 == getFirst(monster).x){
      monsterHealth = monsterHealth - attackPower;
      playerHealth = playerHealth -1.5;
  }

  if (monsterHealth == 4){
      setLegend(
  [ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............5.5.
............5.5.
....444444..555.
...44....44...5.
...4.8...84...5.
...4.8888..4....
...4..888..4....
...4.88.88.4....
...48......4....
....4......4....
....44....44....
.....444444.....
................
................
................`]
);
  }
  if (gotPowerUp == 0){

  if (monsterHealth == 4){
      setLegend(
  [ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............5.5.
............5.5.
....444444..555.
...44....44...5.
...4.8...84...5.
...4.8888..4....
...4..888..4....
...4.88.88.4....
...48......4....
....4......4....
....44....44....
.....444444.....
................
................
................`],[ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`],  [ powerup, bitmap`
..........44444.
..........44..4.
..........44444.
...........111..
...........1.1..
...........1.1..
.1.........1.1..
111.11111..1.1..
..1.1...1..1.1..
..1.1...1..1.1..
..111...1111.1..
.............1..
............11..
11111111111.1...
...........11...
................`]
);
  }
  if (monsterHealth == 3){
      setLegend(
  [ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............555.
..............5.
....444444..555.
...44....44...5.
...4.8...84.555.
...4.88888.4....
...4..888..4....
...4888.88.4....
...48......4....
....4......4....
....44....44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`],  [ powerup, bitmap`
..........44444.
..........44..4.
..........44444.
...........111..
...........1.1..
...........1.1..
.1.........1.1..
111.11111..1.1..
..1.1...1..1.1..
..1.1...1..1.1..
..111...1111.1..
.............1..
............11..
11111111111.1...
...........11...
................`]
);
  }
  if (monsterHealth == 2){
      setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............5555
...............5
....444444...555
...44..8.44..5..
...4.8.8.84..555
...4.88888.4....
...4..888..4....
...4888888.4....
...48..8...4....
....4..8...4....
....44.88.44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`],  [ powerup, bitmap`
..........44444.
..........44..4.
..........44444.
...........111..
...........1.1..
...........1.1..
.1.........1.1..
111.11111..1.1..
..1.1...1..1.1..
..1.1...1..1.1..
..111...1111.1..
.............1..
............11..
11111111111.1...
...........11...
................`]);
  }
  if (monsterHealth == 1){
    setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
.............55.
............555.
....444444....5.
...48888.44...5.
...888.8884..555
...8.88888.4....
...488888884....
...4888888.4....
...488.8.884....
....48888884....
....44.88.44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`],   [ powerup, bitmap`
..........44444.
..........44..4.
..........44444.
...........111..
...........1.1..
...........1.1..
.1.........1.1..
111.11111..1.1..
..1.1...1..1.1..
..1.1...1..1.1..
..111...1111.1..
.............1..
............11..
11111111111.1...
...........11...
................`]);
  }
  if (monsterHealth == 0 || monsterHealth < 0){
    setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
....66888...7...
...66.8...77777.
666..88888..7...
6....88..8887...
6...888.....7...
6..88.8....7....
6.8...88........
66.666.8........
.66.8...88......
....8....8......
...8............`],[ monster, bitmap`
................
................
................
................
................
................
................
................
................
.....444844.....
....488888884...
....4.888888888.
....4444444444..
................
................
................`],
                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`],  [ powerup, bitmap`
..........44444.
..........44..4.
..........44444.
...........111..
...........1.1..
...........1.1..
.1.........1.1..
111.11111..1.1..
..1.1...1..1.1..
..1.1...1..1.1..
..111...1111.1..
.............1..
............11..
11111111111.1...
...........11...
................`],
             );

        
    // increase the current level number
    level = level + 1;

    const currentLevel = levels[level];

    // make sure the level exists and if so set the map
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("you win!", { y: 4, color: color`3` });
    }
  }
    
  }
  else if (gotPowerUp == 1){
  if (monsterHealth == 4){
      setLegend(
  [ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............5.5.
............5.5.
....444444..555.
...44....44...5.
...4.8...84...5.
...4.8888..4....
...4..888..4....
...4.88.88.4....
...48......4....
....4......4....
....44....44....
.....444444.....
................
................
................`],[ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]
);
  }
  if (monsterHealth == 3){
      setLegend(
  [ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............555.
..............5.
....444444..555.
...44....44...5.
...4.8...84.555.
...4.88888.4....
...4..888..4....
...4888.88.4....
...48......4....
....4......4....
....44....44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]
);
  }
  if (monsterHealth == 2){
      setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............5555
...............5
....444444...555
...44..8.44..5..
...4.8.8.84..555
...4.88888.4....
...4..888..4....
...4888888.4....
...48..8...4....
....4..8...4....
....44.88.44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]);
  }
  if (monsterHealth == 1){
    setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
.............55.
............555.
....444444....5.
...48888.44...5.
...888.8884..555
...8.88888.4....
...488888884....
...4888888.4....
...488.8.884....
....48888884....
....44.88.44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]);
  }
  if (monsterHealth == 0 || monsterHealth < 0){
    setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
....66888...7...
...66.8...77777.
666..88888..7...
6....88..8887...
6...888.....7...
6..88.8....7....
6.8...88........
66.666.8........
.66.8...88......
....8....8......
...8............`],[ monster, bitmap`
................
................
................
................
................
................
................
................
................
.....444844.....
....488888884...
....4.888888888.
....4444444444..
................
................
................`],
                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]
             );

        
    // increase the current level number
    level = level + 1;

    const currentLevel = levels[level];

    // make sure the level exists and if so set the map
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("you win!", { y: 4, color: color`3` });
    }
  }
    
  }
  if (monsterHealth == 3){
      setLegend(
  [ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............555.
..............5.
....444444..555.
...44....44...5.
...4.8...84.555.
...4.88888.4....
...4..888..4....
...4888.88.4....
...48......4....
....4......4....
....44....44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]
);
  }
  if (monsterHealth == 2){
      setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
............5555
...............5
....444444...555
...44..8.44..5..
...4.8.8.84..555
...4.88888.4....
...4..888..4....
...4888888.4....
...48..8...4....
....4..8...4....
....44.88.44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]);
  }
  if (monsterHealth == 1){
    setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
......888...7...
......8...77777.
.....88888..7...
.....88..8887...
....888.....7...
...88.8....7....
..8...88........
.....8.8........
....8...88......
....8....8......
...8............`],[ monster, bitmap`
................
.............55.
............555.
....444444....5.
...48888.44...5.
...888.8884..555
...8.88888.4....
...488888884....
...4888888.4....
...488.8.884....
....48888884....
....44.88.44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]);
  }
  if (monsterHealth == 0 || monsterHealth < 0){
    setLegend([ player, bitmap`
................
.....8888...7...
....88...8..7...
....88...8..7...
.....8888...7...
....66888...7...
...66.8...77777.
666..88888..7...
6....88..8887...
6...888.....7...
6..88.8....7....
6.8...88........
66.666.8........
.66.8...88......
....8....8......
...8............`],[ monster, bitmap`
................
................
................
................
................
................
................
................
................
.....444844.....
....488888884...
....4.888888888.
....4444444444..
................
................
................`],
                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`]
             );

        
    // increase the current level number
    level = level + 1;

    const currentLevel = levels[level];

    // make sure the level exists and if so set the map
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("you win!", { y: 4, color: color`3` });
    }
  }
});


// END - PLAYER MOVEMENT CONTROLS

afterInput(() => {
  if (getFirst(player) === getFirst(spikes)){
    playerHealth - 6
  }
  if (gotPowerUp === 1){
    clearTile(0,0);
  }
  else if (getFirst(player).x === getFirst(powerup).x){
    attackPower = attackPower + 1;
    gotPowerUp = 1;
  }
    if (playerHealth < 0 || playerHealth == 0) {
    
    // increase the current level number
    level = level + 1;

    const currentLevel = levels[level];

    // make sure the level exists and if so set the map
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
       setLegend([ player, bitmap`
................
................
................
................
................
................
................
......7.........
......7.........
...7777777777...
88...87.........
.88..87888......
..888888.88.....
.88..8.8.88.....
.8...8..88......
.....8..........`],[ monster, bitmap`
................
.............55.
............555.
....444444....5.
...48888.44...5.
...888.8884..555
...8.88888.4....
...488888884....
...4888888.4....
...488.8.884....
....48888884....
....44.88.44....
.....444444.....
................
................
................`],                [ spikes, bitmap`
................
................
................
................
................
................
................
................
................
................
...3...3.....3..
...3..33....33..
..33..3.3..333..
..33..3.3..3.33.
.3..33...33...3.
33..33...3....33`],   [ powerup, bitmap`
..........44444.
..........44..4.
..........44444.
...........111..
...........1.1..
...........1.1..
.1.........1.1..
111.11111..1.1..
..1.1...1..1.1..
..1.1...1..1.1..
..111...1111.1..
.............1..
............11..
11111111111.1...
...........11...
................`]);
      addText("you lose!", { y: 4, color: color`3` });
    }
  }
});
